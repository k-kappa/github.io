
/* - ++resource++unibo.didattica/didattica.js - */
// https://www.unibo.it/portal_javascripts/++resource++unibo.didattica/didattica.js?original=1
(function($){if((typeof window.unibo)==="undefined")
window.unibo={};var unibo=window.unibo;unibo.didattica={};var didattica=window.unibo.didattica;didattica._getUrlVars=function(url){var vars={};var parts=url.replace(/[?&]+([^=&]+)=([^&]*)/gi,
function(m,key,value){vars[key]=value});return vars};$(document).delegate(".asyncload","click", function(e){var url=$(this).attr('href'),fragment=$(this).data('fragment');history.pushState({},'',url);if(url.indexOf('?')>0){url=url+'&ajax_load=1'}
else{url=url+'?ajax_load=1'}
e.preventDefault();$(fragment).css({position:'relative'});$(fragment).uniboSpinner("show",{template:'#u-didattica-spinner'});$(fragment).load(url+" "+fragment,
function(responseText,textStatus,XMLHttpRequest){$(fragment).uniboSpinner("hide");switch(XMLHttpRequest.status){case 200:break;case 404:$(fragment).html('<p>Looks like the results '+'have not been uploaded to the server yet. '+'Please check back later.</p>');break;default:$(fragment).html('<p>'+XMLHttpRequest.status+': '+XMLHttpRequest.statusText+'. '+'Please contact the support '+'and let them know.</p>');break}})});didattica.resultToggle=function(el){var target=$(el).next();if($(el).hasClass("plus")){target.hide();target.showAccessible();target.slideDown('slow')}
else{target.slideUp('slow', function(){target.hideAccessible();target.show()})}
$(el).toggleClass("plus");$(el).toggleClass("minus")};$.fn.hideAccessible=function(){this.css({position:'absolute',left:'-1000em',top:'-1000em'})};$.fn.showAccessible=function(){this.css('position','static')};$(document).ready(function(){$(document).delegate("body.portaltype-listacorsi a.umtrack","click", function(){if(typeof pageTracker!='undefined'){pageTracker._trackEvent('Sitocorso','Clic',$(this).data('title'))}});if($('body.portaltype-listacorsi').length>0){$("#corsi-catalog").cardsfilter({itemsSelector:'.card-list.order-by-name .item',groupBy:['area'],filter_id_list:["anno"]})}
if($('body.portaltype-listainsegnamenti').length>0){$("#u-searchinsegnamenti").insegnamentifilter()}});var defaults={itemsSelector:'.card-list .item',totalSelector:'.header-dropdown-list .result .number',groupBy:[]};$.fn.cardsfilter=function(usersettings){var settings={};$.extend(settings,defaults,usersettings);return this.each(function(){var ctx=$(this),filtered_by={},order_by='name',facets={};ctx.on("click", function(evt){$(".filter-popup .item").each(function(){if(!$(evt.target).closest('.item').is($(this))){var btn=$(this).find(".button-popup[aria-expanded]");btn.attr("aria-expanded","false");var popup=btn.next(".popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none")}});var searchForm=$('.search-course-wrapper');if(!$(evt.target).closest('.search-course-wrapper').is(searchForm)){var btn=searchForm.find(".button-popup[aria-expanded]");btn.attr("aria-expanded","false");var popup=btn.next(".popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none")}});ctx.on("click",".button-popup", function(event){event.preventDefault();if($(this).attr("aria-expanded")=="true"){$(this).attr("aria-expanded","false");var popup=$(this).next(".popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none")}else{$(this).attr("aria-expanded","true");var popup=$(this).next(".popup-wrapper");popup.attr("aria-hidden","false");popup.css("display","block");if($(this).hasClass("search-button")){popup.find("input[id='cercacorsi']").focus().select()}}});ctx.on("click",".filter-container-popup .close-button", function(event){event.preventDefault();$(this).parents(".popup-wrapper").css("display","none").attr("aria-hidden","true");$(".filter-container-popup .button-popup").attr("aria-expanded","false")});ctx.on("click",".filter-container-popup .back-button", function(event){event.preventDefault();$(this).closest(".popup-wrapper").css("display","none").attr("aria-hidden","true").siblings(".button-popup").attr("aria-expanded","false")});ctx.on("click",".dropdown-list h2 button", function(event){event.preventDefault();var itemContainer=$(this).parent().next(".items-container");var corsi=itemContainer.find('.card-list');if(typeof corsi=='undefined'||corsi.length==0||corsi.is(':empty')){loadFragmentAsync($(this),toogleGroup,$(this))} else{toogleGroup($(this))}});
function toogleGroup(el){var target=el.parent().next(".items-container");if(el.attr("aria-expanded")==="false"){target.hide();target.showAccessible();target.slideDown('slow');el.attr("aria-expanded","true");target.attr("aria-hidden","false")} else{target.slideUp('slow', function(){target.hideAccessible();target.show()});el.attr("aria-expanded","false");target.attr("aria-hidden","true")}}
ctx.on("click",".card-list .item.is-opened .gradient-overlay", function(event){event.preventDefault();$(this).parent().removeClass("is-opened");var btn=$(this).parent().find(".button-popup[aria-expanded]");btn.attr("aria-expanded","false")});ctx.on("click",".card-list .button-popup", function(event){event.preventDefault();if($(this).attr("aria-expanded")=="true"){$(this).parent().addClass("is-opened")}else{$(this).parent().removeClass("is-opened")}});
function loadAsync(url,dest,fragment,callback,args){$(dest).css({position:'relative'});$(dest).uniboSpinner("show",{template:'#u-didattica-spinner'});$(dest).load(url+" "+fragment,
function(responseText,textStatus,XMLHttpRequest){$(fragment).uniboSpinner("hide");switch(XMLHttpRequest.status){case 200:if(callback!==undefined){if(args!==undefined)
callback(args);else
callback()}
break;case 404:$(fragment).html('<p>Looks like the results '+'have not been uploaded to the server yet. '+'Please check back later.</p>');break;default:$(fragment).html('<p>'+XMLHttpRequest.status+': '+XMLHttpRequest.statusText+'. '+'Please contact the support '+'and let them know.</p>');break}})}
function loadFragmentAsync(el,callback,args){var pageUrl="";var parms="";if(el.is("form")){pageUrl=el.attr('action');parms=el.serialize()}
else{pageUrl=el.data("url");parms=el.data("params")}
var url=pageUrl;if(typeof el.data('view')!=='undefined'){url+="/"+el.data('view')}
pageUrl+='?'+parms;url+='?'+parms;var fragment=el.data("fragment");var dest=fragment;if(typeof el.data('dest')!=='undefined')
dest=el.data('dest');if(typeof el.data('history')=='undefined'||el.data('history'))
history.pushState({url:url,dest:dest,fragment:fragment},'',pageUrl);loadAsync(url,dest,fragment,callback,args)}
ctx.on("click",".load-async", function(e){e.preventDefault();loadFragmentAsync($(this))});ctx.on("change","#checkbox_internazionali", function(e){e.preventDefault();$('#corsi-form').find("input[name='intconmul']").remove();if($(this).is(':checked'))
$('#corsi-form').append('<input type="hidden" name="intconmul" value="true" />');loadFragmentAsync($('#corsi-form'),updateFilters)});ctx.on("keydown","input[name='fulltext']", function(e){var keyCode=e.which;if(keyCode==13){var popup=$(this).closest(".search-course.popup-wrapper");var btn=popup.find("button.search-btn");btn.trigger('click')}});ctx.on("click",".search-course-wrapper button.search-btn", function(e){e.preventDefault();$('#corsi-form').find("input[name='fulltext']").remove();var popup=$(this).closest(".search-course.popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none");popup.prev(".search-button.button-popup").attr("aria-expanded","false");var textBox=popup.find("input[name='fulltext']");var value=textBox[0].value;$('#corsi-form').append('<input type="hidden" name="fulltext" value="'+value+'" />');loadFragmentAsync($('#corsi-form'),openAllGroups);textBox[0].value=''});
function openAllGroups(){updateFilters();var orderby=$('#corsi-form').find("input[name='orderby']");if(orderby.value!=="alphabetic")
$(".dropdown-list h2 button").trigger('click')}
function updateForm(el){var item=el.closest(".item");var btn=item.find(".button-popup[aria-expanded]");btn.attr("aria-expanded","false");var popup=btn.next(".popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none");var name=item.find("input:checkbox")[0].name;var selected=item.find("input:checkbox:checked");var checked=(selected.length>0);var theForm=$('#corsi-form');theForm.find("input[name='"+name+"']").remove();if(checked){selected.each(function(e){theForm.append('<input type="hidden" name="'+$(this)[0].name+'" value="'+$(this)[0].value+'" />')})}}
function updateFilters(){var state=$('#corsi-form').data('state');$(".item").each(function(e){var btn=$(this).find(".button-popup");var ul=$(this).find(".popup-wrapper ul");ul.find("li").remove();var id=ul.attr('id');if(id in state){var options=state[id];var opts=options["options"];btn.toggleClass("checked",options['checked']);var i;for(i=0;i<opts.length;i++){var checkbox_id=id+"checkbox"+i;var li=$("<li>");var cb=$("<input>",{id:checkbox_id,name:id,"value":opts[i]["id"],type:"checkbox",checked:opts[i]["selected"],disabled:opts[i]["disabled"]});cb.appendTo(li);var label=$("<label>",{"for":checkbox_id}).text(opts[i]["text"]+[" (",opts[i]["count"],")"].join(''));label.appendTo(li);ul.append(li)}}});var intconmul=$("#checkbox_internazionali");var options=state["intconmul"];var opt=options["options"];intconmul.prop('checked',opt["selected"]);intconmul.prop('disabled',opt["disabled"])}
ctx.on("click",".filter-popup-footer button.apply-filter", function(e){e.preventDefault();updateForm($(this));loadFragmentAsync($('#corsi-form'),updateFilters)});
function refreshCorsiMain(el){var pageUrl=el.attr("href");var parts=pageUrl.split('?');var baseUrl=parts[0];var qs=parts[1];var url=baseUrl+'/catalogo'+'?'+qs;var fragment="#corsi-catalog";history.pushState({url:url,dest:fragment,fragment:fragment},'',pageUrl);loadAsync(url,fragment,fragment)}
ctx.on("click","#corsi-catalog .tab a", function(e){e.preventDefault();refreshCorsiMain($(this))});ctx.on("click","#corsi-ordina-per li a", function(e){e.preventDefault();refreshCorsiMain($(this))});ctx.on("click","body.portaltype-listacorsi .pagination a", function(e){e.preventDefault();refreshCorsiMain($(this))});var initialize=function(){$(window).bind('popstate', function(event){var state=event.originalEvent.state;if(state!==null){if(state.url!==undefined&&state.dest!==undefined&&state.fragment!==undefined){loadAsync(state.url,state.dest,state.fragment,updateFilters);return}}
var parts=location.href.split('?');var url=[parts[0],'/catalogo'].join('');if(parts.length>1)
url+="?"+parts[1];loadAsync(url,"#corsi-catalog","#corsi-catalog")})};initialize();history.pushState(filtered_by,'');return ctx})};$.fn.insegnamentifilter=function(){return this.each(function(){var ctx=$(this);ctx.on("click",".popup-toggler", function(event){event.preventDefault();if($(this).attr("aria-expanded")=="true"){$(this).attr("aria-expanded","false");$(this).toggleClass("open close");var popup=$(this).next(".popup-wrapper");popup.attr("aria-hidden","true");popup.css("display","none")}else{$(this).attr("aria-expanded","true");$(this).toggleClass("close open");var popup=$(this).next(".popup-wrapper");popup.attr("aria-hidden","false");popup.css("display","block")}})})}})(jQuery);
